REQUIREMENTS
============


* Ruby
* Rails
* Rubygem
* Webserver
* Database
* MTA (Postfix or Sendmail ...)


INSTALLATION
============


1. Install the required plugin
 - mime-types
 - shared-mime-info
1. Decompress and put this Directory somewhere (e.g /usr/local/deco )
2. Create your config/database.yml
3. Create database (Note: Database for DECO must use UTF-8 character set.)
4. Setup your Web server 




RECOMMENDED INSTALLATION
=========================


We think that we should separate the Web Server for service and the Web Server for management.


e.g.


(Internet)
  |
[F/W]--(DMZ) 10.0.0.0/24
  |     + Web Server #1 (for service
  |  
(Local network) 192.168.0.0/24
+ Web Server #2 (for management
+ Database Server


<How to install Database Server (CentOS 5)>


# yum -y install mysql mysql-server


Note: Database for DECO must use UTF-8 character set.


add the following lines to my.cnf
---------------------------
default-character-set=utf8
---------------------------
    
# /etc/init.d/mysqld start


# mysql
> GRANT ALL PRIVILEGES ON deco_production.* TO deco@'192.168.0.0/255.255.255.0' IDENTIFIED BY '********';
> GRANT ALL PRIVILEGES ON deco_production.* TO deco@'10.0.0.0/255.255.255.0' IDENTIFIED BY '********';
> create database deco_production;


<How to install Web Server #1 (CentOS 5)>


1. Install Ruby
# cd /usr/local/src
# tar xjvf ruby-1.8.7-p302.tar.bz2
# cd ruby-1.8.7-p302
# make
# make install


2. Install Rubygem
# cd /usr/local/src
# tar xzvf rubygems-1.3.7.tgz
# cd rubygems-1.3.7
# ruby setup.rb


3. Install Rails
# gem install rails --version=2.2.2


4. Install Apache + Passenger
# yum -y install httpd httpd-devel


Add the following lines to httpd.conf.
-----------------------------------------


<VirtualHost *:80>
  ServerName deco
  DocumentRoot /usr/local/deco/public
  RailsEnv production
  <Directory /usr/local/deco/public>
    AllowOverride all
    Options -MultiViews
  </Directory>
</VirtualHost>


-----------------------------------------


# gem install passenger
# passenger-install-apache2-module


Edit the following file.
[/etc/httpd/conf.d/rails.conf]---------------------------------------------------------------------------------
   LoadModule passenger_module /usr/local/lib/ruby/gems/1.8/gems/passenger-2.2.15/ext/apache2/mod_passenger.so
   PassengerRoot /usr/local/lib/ruby/gems/1.8/gems/passenger-2.2.15
   PassengerRuby /usr/local/bin/ruby
---------------------------------------------------------------------------------------------------------------
    
# yum -y install mysql mysql-devel


5. Install  plugin


gem install mime-types
gem install shared-mime-info
gem install mysql


6. Install DECO


Decompress and put this Directory somewhere.
# cd /usr/local
# tar xzvf deco.tar.gz


Edit config/database.yml.
--------------------------------------
production:
  adapter: mysql
  encoding: utf8
  database: deco_production
  pool: 5
  host: (IP address of database)
  username: deco
  password: ********
  socket: /var/lib/mysql/mysql.sock
--------------------------------------


# cd /usr/local/deco
# rake db:migrate RAILS_ENV=production


Edit app/models/notification.rb, and  config/environments/production.rb to adjust to your environment.

Edit app/models/notification.rb
from       "<name1@sample.com>"

e.g. config/environments/production.rb
add this
ActionMailer::Base.smtp_settings[:address] = "10.0.0.15"
ActionMailer::Base.smtp_settings[:domain] = "example.jp"


Remove the following files.
rm -f app/controllers/sys_*


Restart Apache.
# /etc/init.d/httpd restart


<How to install Web Server #2 (CentOS 5)>


1. Install Ruby
# cd /usr/local/src
# tar xjvf ruby-1.8.7-p302.tar.bz2
# cd ruby-1.8.7-p302
# make
# make install


2. Install Rubygem
# cd /usr/local/src
# tar xzvf rubygems-1.3.7.tgz
# cd rubygems-1.3.7
# ruby setup.rb


3. Install Rails
# gem install rails --version=2.2.2


4. Install Apache + Passenger
# yum -y install httpd httpd-devel


Add the following lines to httpd.conf
-----------------------------------------


<VirtualHost *:80>
  ServerName deco
  DocumentRoot /usr/local/deco/public
  RailsEnv production
  <Directory /usr/local/deco/public>
    AllowOverride all
    Options -MultiViews
  </Directory>
</VirtualHost>


-----------------------------------------


# gem install passenger
# passenger-install-apache2-module


Edit the following file.
[/etc/httpd/conf.d/rails.conf]---------------------------------------------------------------------------------
   LoadModule passenger_module /usr/local/lib/ruby/gems/1.8/gems/passenger-2.2.15/ext/apache2/mod_passenger.so
   PassengerRoot /usr/local/lib/ruby/gems/1.8/gems/passenger-2.2.15
   PassengerRuby /usr/local/bin/ruby
---------------------------------------------------------------------------------------------------------------


# yum -y install mysql mysql-devel


5. Install required plugin


# gem install mime-types
# gem install shared-mime-info
# gem install mysql


6. Install DECO


Decompress and put this Directory somewhere.
# cd /usr/local
# tar xzvf deco.tar.gz


Edit config/database.yml.
--------------------------------------
production:
  adapter: mysql
  encoding: utf8
  database: deco_production
  pool: 5
  host: (IP address of database)
  username: deco
  password: ********
  socket: /var/lib/mysql/mysql.sock
--------------------------------------


Edit app/models/notification.rb, and config/environments/production.rb to adjust to your environment.

Edit app/models/notification.rb
from       "<name1@sample.com>"

e.g. config/environments/production.rb
add this
ActionMailer::Base.smtp_settings[:address] = "10.0.0.15"
ActionMailer::Base.smtp_settings[:domain] = "example.jp"

Edit config/routes.rb.
---------------------------------------------
-map.root :controller => "top"
+map.root :controller => "sys_top"
---------------------------------------------------------


Restart Apache.
# /etc/init.d/httpd restart
    
<How to set up DECO>
Enter the following URL into a web browser to access management page.
http://(Web Server #2 IP address)/